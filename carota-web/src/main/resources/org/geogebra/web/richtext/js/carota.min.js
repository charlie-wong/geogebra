!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=10)}([function(t,e,n){"use strict";function s(t,n){return Object.keys(e.defaultFormatting).every(e=>t[e]===n[e])}function i(t){const n={text:t.text};return Object.keys(e.defaultFormatting).forEach(s=>{const i=t[s];i&&i!==e.defaultFormatting[s]&&(n[s]=i)}),n}function r(t){return"string"==typeof t?t.length:1}function o(t){return"string"==typeof t?t:"_"}function*l(t,e,n){if(0!==n)if("string"!=typeof t)if(Array.isArray(t)){let s=0;for(const i of t){if(n<=0)break;const t=r(i);if(s+t>e)if("string"==typeof i){const t=i.substr(Math.max(0,e-s),n);yield t,n-=t.length}else yield i,n-=1;s+=t}}else yield t;else yield t.substr(e,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.defaultFormatting={size:16,font:"Arial, sans-serif",color:"black",bgcolor:"transparent",bold:!1,italic:!1,underline:!1,strikeout:!1,align:"left",script:"normal",url:""},e.multipleValues={},e.sameFormatting=s,e.clone=i,e.cloneWith=function(t,n){const s={text:n};return Object.keys(e.defaultFormatting).forEach(n=>{const i=t[n];i&&i!==e.defaultFormatting[n]&&(s[n]=i)}),s},e.merge=function(t,n){const s={};return Object.keys(e.defaultFormatting).forEach(i=>{(i in t||i in n)&&(t[i]===n[i]?s[i]=t[i]:s[i]=e.multipleValues)}),s.url=t.url||n.url,s},e.format=function t(n,s){Array.isArray(n)?n.forEach(e=>{t(e,s)}):Object.keys(s).forEach(t=>{s[t]!==e.multipleValues&&(n[t]=s[t])})},e.consolidate=function*(t){let e;for(const n of t)e&&s(e,n)&&"string"==typeof e.text&&"string"==typeof n.text?e.text+=n.text:(e=i(n),yield e)},e.getPlainText=function(t){if("string"==typeof t.text)return t.text;if(Array.isArray(t.text)){const e=[];return t.text.forEach(t=>{e.push(o(t))}),e.join("")}return"_"},e.getPieceLength=r,e.getPiecePlainText=o,e.getTextLength=function(t){if("string"==typeof t)return t.length;if(Array.isArray(t)){let e=0;return t.forEach(t=>{e+=r(t)}),e}return 1},e.getSubText=l,e.getTextChar=function(t,e){return l(t,e,1).next().value}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,n,s){this.l=t,this.t=e,this.w=n,this.h=s,this.r=t+n,this.b=e+s}contains(t,e){return t>=this.l&&t<this.r&&e>=this.t&&e<this.b}stroke(t){t.strokeRect(this.l,this.t,this.w,this.h)}fill(t){t.fillRect(this.l,this.t,this.w,this.h)}offset(t,e){return new s(this.l+t,this.t+e,this.w,this.h)}equals(t){return this.l===t.l&&this.t===t.t&&this.w===t.w&&this.h===t.h}center(){return{x:this.l+this.w/2,y:this.t+this.h/2}}}e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(1);class i{constructor(t){this.type=t}children(){return[]}parent(){return null}first(){return this.children()[0]}last(){return this.children()[this.children().length-1]}next(){let t=this;for(;;){const e=t.parent();if(!e)return null;const n=e.children();let s=n[n.indexOf(t)+1];if(s){for(;;){const t=s.first();if(!t)break;s=t}return s}t=e}}previous(){const t=this.parent();if(!t)return null;const e=t.children(),n=e[e.indexOf(this)-1];if(n)return n;const s=t.previous();return s?s.last():null}byOrdinal(t){for(const e of this.children())if(t>=e.ordinal&&t<e.ordinal+e.length){const n=e.byOrdinal(t);if(n)return n}return this}byCoordinate(t,e){if(0==this.children().length)return this;for(const n of this.children()){if(n.bounds().contains(t,e)){let s=n.byCoordinate(t,e);if(s)return s}}let n=this.last();for(;n;){const t=n.last();if(!t)break;n=t}const s=n.next();return!n.newLine&&s&&s.block&&(n=s),n}draw(t,e){this.children().forEach(n=>{n.draw(t,e)})}parentOfType(t){const e=this.parent();return e&&(e.type===t?e:e.parentOfType(t))}bounds(t){let e=this._left,n=this._top,i=0,r=0;return this.children().forEach(t=>{const s=t.bounds();e=Math.min(e,s.l),n=Math.min(n,s.t),i=Math.max(i,s.l+s.w),r=Math.max(r,s.t+s.h)}),new s.default(e,n,i-e,r-n)}}e.Node=i;e.GenericNode=class extends i{constructor(t,e,n,s){super(t),this._children=[],this._parent=e,this._left="number"==typeof n?n:Number.MAX_VALUE,this._top="number"==typeof s?s:Number.MAX_VALUE}children(){return this._children}parent(){return this._parent}finalize(t,e){let n=Number.MAX_VALUE,s=0;this._children.forEach(t=>{n=Math.min(n,t.ordinal),s=Math.max(s,t.ordinal+t.length)}),this.ordinal=n-(t||0),this.length=(e||0)+s-n}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(0);function i(t){let e=t&&t.size||s.defaultFormatting.size;if(t)switch(t.script){case"super":case"sub":e*=.8}return(t&&t.italic?"italic ":"")+(t&&t.bold?"bold ":"")+" "+e+"px "+(t&&t.font||s.defaultFormatting.font)}function r(t,e){t.fillStyle=e&&e.bgcolor||s.defaultFormatting.bgcolor}function o(t,e){t.fillStyle=e&&e.color||s.defaultFormatting.color,t.font=i(e)}function l(t){t.textAlign="left",t.textBaseline="alphabetic"}function a(t){const e=["font: ",i(t),"; color: ",t&&t.color||s.defaultFormatting.color];if(t)switch(t.script){case"super":e.push("; vertical-align: super");break;case"sub":e.push("; vertical-align: sub")}return e.join("")}e.getFontString=i,e.applyRunBackgroundStyle=r,e.applyRunStyle=o,e.prepareContext=l,e.getRunStyle=a,e.nbsp=String.fromCharCode(160),e.enter=String.fromCharCode(160);class c{constructor(t,e,n){this.width=t,this.ascent=e,this.descent=n,this.height=e+n}}function h(t,n,s){const r=document.createElement("canvas").getContext("2d");r.font=i(n);const o=r.measureText(t);if(o.actualBoundingBoxAscent&&o.actualBoundingBoxDescent)return new c(o.width,o.actualBoundingBoxAscent,o.actualBoundingBoxDescent);const l=document.createElement("span"),a=document.createElement("div"),h=document.createElement("div");a.style.display="inline-block",a.style.width="1px",a.style.height="0",h.style.visibility="hidden",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.width="2000px",h.style.height="200px",h.appendChild(l),h.appendChild(a),document.body.appendChild(h);try{l.setAttribute("style",s),l.innerHTML="",l.appendChild(document.createTextNode(t.replace(/\s/g,e.nbsp))),a.style.verticalAlign="baseline";const n=a.offsetTop-l.offsetTop;return a.style.verticalAlign="bottom",new c(o&&o.width||l.offsetWidth,n,a.offsetTop-l.offsetTop-n)}finally{h.parentNode.removeChild(h)}}e.Measure=c,e.measureText=h;const d=(()=>{const t=new Map;return function(e,n){const s=a(n),i=s+"<>!&%"+e;let r=t.get(i);return r||(r=h(e,n,s),t.set(i,r)),r}})();e.measure=function(t,e){return d(t,e)},e.draw=function(t,n,s,i,a,c,h,d){switch(l(t),s.script){case"super":a-=h*(1/3);break;case"sub":a+=d/2}s.bgcolor&&(r(t,s),t.fillRect(i,a-h,c,h+d)),o(t,s),t.fillText("\n"===n?e.nbsp:n,i,a),s.underline&&t.fillRect(i,1+a,c,1),s.strikeout&&t.fillRect(i,1+a-h/2,c,1)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3),i=n(2),r=n(1),o=n(0),l=n(3),a=n(7),c=n(17),h=(t,e)=>({eof:!0,name:t,type:e}),d=t=>({measure:e=>{const n=s.measure(s.nbsp,e),i=s.measure(t,e);return new l.Measure(i.width,Math.max(n.ascent,i.ascent),Math.max(n.descent,i.descent))},draw:(e,n,i,r,o,l,a)=>{s.draw(e,t,a,n,i,r,o,l)},name:"marker"}),u=(new Map).set("number",t=>{return d(t+1+".")}).set("bullet",()=>{return d("â€¢")}),f=(new Map).set("listNext",h).set("listEnd",h).set("listStart",(t,e)=>({name:t,type:e=e||"number",block:(t,n,s,o,l,h)=>{const d=new i.GenericNode("list",l,t,n);let f=h,g=[];const p=function(){const l=new i.GenericNode("item",d),h=u.get(e)(d.children().length);let p=new c.default(h,l,o,1,f);p.block=!0;const w=a.frame(g,t+40,n,s-40,o+1,l,p.measured.ascent,p.measured.descent);o=w.ordinal+w.length;const m=w.bounds(),b=w.first(),y=t+40-10-p.measured.width,x=new r.default(t,n,40,m.h);"baseline"in b?p.position(y,b.baseline,x):p.position(y,n+p.measured.ascent,x),n=m.t+m.h,l.children().push(p),l.children().push(w),l.finalize(),d.children().push(l),p=null};return function(t){g.push(t);const n=t.code();if(n){if("listEnd"===n.name)return p(),d.finalize(),d;"listNext"===n.name&&(n.type=e,g.pop(),p(),g=[],f=t.codeFormatting())}}}}));e.default=function(t,n){const s=e.customCodes&&e.customCodes(t,n);if(s)return s;const i=f.get(t.$);return i&&i(t.$,t.marker)};const g=t=>t&&t.code()&&t.code().name;e.editFilter=function(t){let e=function(t){let e=0;for(const n of t){const t=n.code();if(t)switch(t.name){case"listStart":e++;break;case"listEnd":if(e<=0)return!1;e--}}return 0==e}(t.words),n=!1;for(let s=0;s<t.words.length-1;s++){const i=t.words[s];if(i.isNewLine()&&n){if("listNext"==g(t.words[s-1])&&"listEnd"==g(t.words[s+1])){const e=[{text:{$:"listEnd"}},{text:"\n"}];return t.spliceWordsWithRuns(s-1,3,e,!1),!0}const n={$:e?"listNext":"listEnd"};return t.spliceWordsWithRuns(s,1,[o.cloneWith(i.codeFormatting(),n)],!1),!0}const r=i.code();if(r)switch(r.name){case"listStart":if(n)return t.spliceWordsWithRuns(s,1,[{text:{$:"listNext"}}],!1),!0;n=!0;break;case"listNext":if(!n){const e=o.cloneWith(i.codeFormatting(),{$:"listStart",marker:r.type});return t.spliceWordsWithRuns(s,1,[e],!1),!0}break;case"listEnd":if(!n)return t.spliceWordsWithRuns(s,1,[{text:"\n"}],!1),!0;n=!1}}if(n)return t.spliceWordsWithRuns(t.words.length-1,0,[{text:{$:"listEnd"}}],!1),!0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3),i=n(3),r=n(4);class o{constructor(){this.name="inline"}measure(t){const e=s.measure("?",t);return new i.Measure(e.width+4,e.width+2,e.width+2)}draw(t,e,n,s,i,r){t.fillStyle="silver",t.fillRect(e,n-i,s,i+r),t.strokeRect(e,n-i,s,i+r),t.fillStyle="black",t.fillText("?",e+2,n)}}class l{constructor(t,e,n,s){this.run=t,this.isNewLine=e,this.isNewLine=e,this.width=e?0:n.width,this.ascent=n.ascent,this.descent=n.descent,this.code=s}draw(t,e,n){"string"==typeof this.run.text?s.draw(t,this.run.text,this.run,e,n,this.width,this.ascent,this.descent):this.code&&this.code.draw&&(t.save(),this.code.draw(t,e,n,this.width,this.ascent,this.descent,this.run),t.restore())}}e.Part=l,e.part=function(t){let e,n,a;return"string"==typeof t.text?(n=1===t.text.length&&"\n"===t.text[0],e=s.measure(n?s.nbsp:t.text,t)):e=(a=r.default(t.text)||new o).measure?a.measure(t):new i.Measure(0,0,0),new l(t,n,e,a)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.gmap=function*(t,e){for(const n of t)yield e(n)},e.gfoldl=function(t,e){let n=t.next().value;for(const s of t)n=e(n,s);return n},e.gfilter=function*(t,e){for(const n of t)e(n)&&(yield n)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(2),i=n(1),r=n(15);class o extends s.Node{constructor(t,e,n){super("frame"),this.lines=t,this._parent=e,this.ordinal=n}bounds(){if(!this._bounds){let t=0,e=0,n=0,s=0;if(this.lines.length){const i=this.lines[0].bounds();t=i.l,e=i.t,this.lines.forEach(t=>{const e=t.bounds();n=Math.max(n,e.l+e.w),s=Math.max(s,e.t+e.h)})}this._bounds=new i.default(t,e,n-t,this.height||s-e)}return this._bounds}actualWidth(){if(!this._actualWidth){let t=0;this.lines.forEach(e=>{"number"==typeof e.actualWidth&&(t=Math.max(t,e.actualWidth))}),this._actualWidth=t}return this._actualWidth}children(){return this.lines}parent(){return this._parent}draw(t,e){const n=e?e.t:0,s=e?e.t+e.h:Number.MAX_VALUE;this.lines.some(i=>{const r=i.bounds();return!(r.t+r.h<n)&&(r.t>s||void i.draw(t,e))})}}e.Frame=o,e.frame=function(t,e,n,s,i,l,a,c){const h=[],d=new o(h,l,i),u=r.default(t,e,n,s,i,d,a,c);for(const t of u)"number"==typeof t?d.height=t:(d.length=t.ordinal+t.length-i,h.push(t));return d}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(1),i=n(5),r=n(3),o=n(2),l=n(0),a=()=>r.measure(r.enter,l.defaultFormatting).width;class c extends o.Node{constructor(t,e,n,s,i){super("character"),this.left=t,this.part=e,this.word=n,this.ordinal=s,this.length=i}bounds(){const t=this.word.bounds(),e=this.word.word.isNewLine()?a():this.width||this.part.width;return new s.default(t.l+this.left,t.t,e,t.h)}parent(){return this.word}byOrdinal(){return this}byCoordinate(t,e){return t<=this.bounds().center().x?this:this.next()}}e.PositionedChar=c;class h extends o.Node{constructor(t,e,n,s,i){super("word"),this.word=t,this.line=e,this.left=n,this.ordinal=s,this.width=i,this.length=t.text.length+t.space.length}draw(t){this.word.draw(t,this.line.left+this.left,this.line.baseline)}bounds(){return new s.default(this.line.left+this.left,this.line.baseline-this.line.ascent,this.word.isNewLine()?a():this.width,this.line.ascent+this.line.descent)}*parts(){yield*this.word.text.parts,yield*this.word.space.parts}realiseCharacters(){if(!this._characters){const t=[];let e=0;const n=this;let s=this.ordinal;for(const r of this.parts()){const o=o=>{const l=Object.assign({},r.run);l.text=o;const a=i.part(l);t.push(new c(e,a,n,s,1)),e+=a.width,s++},l=r.run.text;if("string"==typeof l)for(const t of l)o(t);else o(l)}const r=t[t.length-1];r&&(r.width=this.width-r.left,(this.word.isNewLine()||this.word.code()&&this.word.code().eof)&&(r.newLine=!0)),this._characters=t}}children(){return this.realiseCharacters(),this._characters}parent(){return this.line}}e.PositionedWord=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(5),i=n(0),r=n(6);class o{constructor(t,e,n){this.text=t,this.space=e,this.softWrap=n,this.ascent=Math.max(t.ascent,e.ascent),this.descent=Math.max(t.descent,e.descent),this.width=t.width+e.width,this.length=t.length+e.length}isNewLine(){return 1===this.text.parts.length&&this.text.parts[0].isNewLine}code(){return 1===this.text.parts.length&&this.text.parts[0].code}codeFormatting(){return 1===this.text.parts.length&&this.text.parts[0].run}draw(t,e,n){const s=s=>{s.draw(t,e,n),e+=s.width};this.text.parts.forEach(s),this.space.parts.forEach(s)}plainText(){return this.text.plainText+this.space.plainText}align(){const t=this.text.parts[0];return t?t.run.align:"left"}*runs(t){let e=t&&t.start||0,n=t&&t.end;void 0===n&&(n=Number.MAX_VALUE);for(const t of[this.text,this.space])for(const s of t.parts){if(e>=n||n<=0)return!0;const t=s.run,i=t.text;if("string"==typeof i){if(e<=0&&n>=i.length)yield t;else if(e<i.length){const s=Object.assign({},t),r=Math.max(0,e);s.text=i.substr(r,Math.min(i.length,n-r)),yield s}e-=i.length,n-=i.length}else e<=0&&n>=1&&(yield t),e--,n--}}}e.Word=o;class l{constructor(t){this.parts=t,this.ascent=0,this.descent=0,this.width=0,this.length=0,this.plainText="";for(const e of t)this.ascent=Math.max(this.ascent,e.ascent),this.descent=Math.max(this.descent,e.descent),this.width+=e.width,this.length+=i.getPieceLength(e.run.text),this.plainText+=i.getPiecePlainText(e.run.text)}}e.Section=l,e.word=function(t){let e,n;return t?(e=new l([...r.gmap(t.text.cut(t.spaces),s.part)]),n=new l([...r.gmap(t.spaces.cut(t.end),s.part)])):(e=new l([s.part({text:"\n"})]),n=new l([])),new o(e,n,!1)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(11),i=n(0),r=n(20),o=n(4);if(e.bundle={editor:s,runs:i,html:r,codes:o},"undefined"!=typeof window&&window.document){if(window.carota)throw new Error("Something else is called carota!");window.carota=e.bundle}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(12),i=n(1);e.create=function(t){t.innerHTML='<canvas width="100" height="100" class="carotaEditorCanvas" style="position: absolute;"></canvas><div class="carotaTextArea" style="overflow: hidden; position: absolute; height: 0; top: 0"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0; width: 1000px; height: 1em; outline: none; font-size: 4px;"></textarea>',t.style.overflow="hidden";const e=t.querySelector("canvas"),n=t.querySelector(".carotaTextArea"),r=t.querySelector("textarea"),o=new s.CarotaDocument;let l,a=0,c=null,h=null,d=null,u=null,f="",g=null;const p=(new Map).set(66,"bold").set(73,"italic").set(85,"underline").set(83,"strikeout"),w=function(t,e){return e<0?t<=0:t>=o.frame.length-1},m=function(t,e){return t.b<=e.t||e.b<=t.t},b=function(t,e){let n,s=o.getCaretCoords(t);for(h=null!==c?c:s.l;!w(t,e)&&(t+=e,n=o.getCaretCoords(t),!m(n,s)););for(s=n;!w(t,e)&&!(e>0&&n.l>=h||e<0&&n.l<=h);)if(t+=e,n=o.getCaretCoords(t),m(n,s)){t-=e;break}return t},y=function(t,e){const n=o.getCaretCoords(t);let s;for(;!w(t,e);)if(t+=e,s=o.getCaretCoords(t),m(s,n)){t-=e;break}return t};r.addEventListener("keydown",t=>{(function(t,e,n){let s=o.selection.start,i=o.selection.end;const r=o.frame.length-1;let d=!1;if(h=null,e){if(!a)switch(t){case 37:case 38:case 36:case 33:a=-1;break;case 39:case 40:case 35:case 34:a=1}}else a=0;let f=1===a?i:s,w=!1;switch(t){case 37:if(e||s===i){if(f>0)if(n){const t=o.wordContainingOrdinal(f);f=t.ordinal===f?t.index>0?o.wordOrdinal(t.index-1):0:t.ordinal}else f--}else f=s;w=!0;break;case 39:if(e||s===i){if(f<r)if(n){const t=o.wordContainingOrdinal(f);f=t.ordinal+t.word.length}else f++}else f=i;w=!0;break;case 40:f=b(f,1),w=!0;break;case 38:f=b(f,-1),w=!0;break;case 36:f=y(f,-1),w=!0;break;case 35:f=y(f,1),w=!0;break;case 33:f=0,w=!0;break;case 34:f=r,w=!0;break;case 8:s===i&&s>0&&(o.range(s-1,s).clear(),u=s-1,o.select(u,u),d=!0);break;case 46:s===i&&s<r&&(o.range(s,s+1).clear(),d=!0);break;case 90:n&&(d=!0,o.performUndo());break;case 89:n&&(d=!0,o.performUndo(!0));break;case 65:n&&(d=!0,o.select(0,r));break;case 67:case 88:n&&(l=o.selectedRange().save(),g=o.selectedRange().plainText())}const m=p.get(t);if(n&&m){const t=o.selectedRange();t.setFormatting(m,!0!==t.getFormatting()[m]),x(),d=!0}if(w){switch(a){case 0:s=i=f;break;case-1:s=f;break;case 1:i=f}if(s===i)a=0;else if(s>i){a=-a;const t=i;i=s,s=t}u=f,o.select(s,i),d=!0}return c=h,d})(t.keyCode,t.shiftKey,t.ctrlKey)&&t.preventDefault()});const x=()=>{const n=1*t.clientWidth;o.width()!==n&&o.setWidth(n);o.frame.bounds().h;const s=Math.max(1,window.devicePixelRatio||1),l=Math.max(o.frame.actualWidth(),t.clientWidth),a=t.clientHeight;e.width=s*l,e.height=s*a,e.style.width=l+"px",e.style.height=a+"px";const c=e.getContext("2d");c.scale(s,s),o.draw(c,new i.default(0,0,l,a)),o.drawSelection(c,!!d||document.activeElement===r)};r.addEventListener("input",()=>{let t=r.value;f!==t&&(f="",r.value="",t===g&&(t=l),o.insert(t))});const _=()=>{u=null===u?o.selection.end:u;const e=o.byOrdinal(u);if(u=null,e){const n=e.bounds();r.focus();const s=Math.max(0,n.t+n.h-(t.scrollTop+t.clientHeight));s&&(t.scrollTop+=s);const i=Math.max(0,t.scrollTop-n.t);i&&(t.scrollTop-=i);const o=Math.max(0,n.l-(t.scrollLeft+t.clientWidth));o&&(t.scrollLeft+=o);const l=Math.max(0,t.scrollLeft-n.l);l&&(t.scrollLeft-=l)}f=o.selectedRange().plainText(),r.value=f,r.select(),setTimeout(()=>{r.focus()},10)};o.selectionChanged((t,e)=>{x(),d||!1!==e&&_()});const v=(s,i)=>{e.addEventListener(s,e=>{const s=n.getBoundingClientRect(),r=t.style.transform;let l=0;r&&(l=Number.parseFloat(r.match(/rotate\((-?\d*.?\d*)rad\)/)[1]));const a=e.clientX-s.left,c=e.clientY-s.top,h=Math.cos(l),d=Math.sin(l),u=a*h+c*d,f=c*h-a*d;i(o.byCoordinate(u,f)),e.preventDefault()})};v("mousedown",t=>{d=t.ordinal,o.select(t.ordinal,t.ordinal),c=null}),v("dblclick",t=>{(t=t.parent())&&o.select(t.ordinal,t.ordinal+(t.word?t.word.text.length:t.length))}),v("mousemove",t=>{null!==d&&t&&(u=t.ordinal,d>t.ordinal?o.select(t.ordinal,d):o.select(d,t.ordinal))}),v("mouseup",t=>{d=null,c=null,_(),r.focus()});let C=(new Date).getTime(),k=!1,O=t.clientWidth,M=t.clientHeight;const E=function(){let e=!1;const n=document.activeElement===r;k!==n&&(k=n,e=!0);const s=(new Date).getTime();s>C&&(C=s+500,o.toggleCaret()&&(e=!0)),t.clientWidth===O&&t.clientHeight===M||(e=!0,O=t.clientWidth,M=t.clientHeight),e&&x()};return E(),setInterval(E,200),o}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(13),i=n(14),r=n(9),o=n(2),l=n(0),a=n(18),c=n(19),h=n(7),d=n(4),u=n(1),f=n(6),g=n(8),p=n(0),w=(t,e,n,s)=>{const i=t.selection.start,r=t.selection.end;return o=>{t._wordOrdinals=[];const l=t.words.splice(e,n,...s);o(w(t,e,s.length,l)),t._nextSelection={start:i,end:r}}},m=t=>{const e=[];return t(t=>{e.push(t),this.length=e.length}),t=>{t(m(t=>{for(;e.length;)e.pop()(t)}))}},b=t=>{if(t.isNewLine())return!0;const e=t.code();return!(!e||!e.block&&!e.eof)},y=(t,e)=>[...f.gmap(f.gfilter(i.split(s.characters([l.cloneWith(t.codeFormatting(),e)])),t=>!!t),r.word)],x=t=>t&&t.code()&&t.code().name;class _ extends o.Node{constructor(){super("document"),this._width=0,this.selection={start:0,end:0},this.caretVisible=!0,this.selectionChanged=c.default(),this.contentChanged=c.default(),this.load([])}load(t,e){this.undo=[],this.redo=[],this._wordOrdinals=[],this.words=[],this.words=[...f.gmap(i.split(s.characters(t)),r.word)],this.layout(),this.contentChanged.fire(),this.select(0,0,e)}layout(){this.frame=null;try{this.frame=h.frame(this.words,0,0,this._width,0,this)}catch(t){console.error(t)}if(this.frame){if(this._nextSelection){const t=this._nextSelection;delete this._nextSelection,this.select(t.start,t.end,!1)}}else console.error("A bug somewhere has produced an invalid state - rolling back"),this.performUndo()}range(t,e){return new a.Range(this,t,e)}documentRange(){return this.range(0,this.frame.length-1)}selectedRange(){return this.range(this.selection.start,this.selection.end)}save(){return this.documentRange().save()}paragraphRange(t,e){const n=this.wordContainingOrdinal(t);if(t=0,n&&!b(n.word))for(let e=n.index;e>0;e--)if(b(this.words[e-1])){t=this.wordOrdinal(e);break}const s=this.wordContainingOrdinal(e);if(e=this.frame.length-1,s&&!b(s.word))for(let t=s.index;t<this.words.length;t++)if(b(this.words[t])){e=this.wordOrdinal(t);break}return this.range(t,e)}hyperlinkRange(t,e){for(;t>0&&this.range(t,t).getFormatting().url;)t--;for(;e<this.frame.length-1&&this.range(e+1,e+1).getFormatting().url;)e++;return this.range(t,e)}insert(t,e){this.select(this.selection.end+this.selectedRange().setText(t),null,e)}modifyInsertFormatting(t,e){this.nextInsertFormatting[t]=e,this.notifySelectionChanged(!1)}applyInsertFormatting(t){const e=this.nextInsertFormatting,n=Object.keys(e);n.length&&t.forEach(t=>{n.forEach(n=>{t[n]=e[n]})})}wordOrdinal(t){if(t<this.words.length){const e=this._wordOrdinals.length;if(e<t+1){let n=e>0?this._wordOrdinals[e-1]:0;for(let s=e;s<=t;s++)this._wordOrdinals[s]=n,n+=this.words[s].length}return this._wordOrdinals[t]}}wordContainingOrdinal(t){let e=0;for(let n=0;n<this.words.length;n++){const s=this.words[n];if(t>=e&&t<e+s.length)return{word:s,ordinal:e,index:n,offset:t-e};e+=s.length}}*runs(t){const e=this.wordContainingOrdinal(Math.max(0,t.start)),n=this.wordContainingOrdinal(Math.min(t.end,this.frame.length-1));if(e.index===n.index)yield*e.word.runs({start:e.offset,end:n.offset});else{yield*e.word.runs({start:e.offset});for(let t=e.index+1;t<n.index;t++)yield*this.words[t].runs();yield*n.word.runs({end:n.offset})}}spliceWordsWithRuns(t,e,n,o=!0){this.spliceWords(t,e,[...f.gmap(f.gfilter(i.split(s.characters(n)),t=>!!t),r.word)],o)}spliceWords(t,e,n,s=!0){const i=this;this.transaction(r=>{if(w(i,t,e,n)(r),s&&!this._filtersRunning){for(this._filtersRunning=!0;d.editFilter(i););this._filtersRunning=!1}})}splice(t,e,n){let s;if("string"==typeof n){const i=Math.max(0,t-1),r=this.runs({start:i,end:i+1}).next().value;if(s=[r?l.cloneWith(r,n):{text:n}],r&&r.url){const n=this.runs({start:t,end:t+1}).next().value||p.defaultFormatting;(t==e&&0==t||n.url!=r.url)&&(delete s[0].url,delete s[0].color,delete s[0].underline)}}else s=Array.isArray(n)?n:[{text:n}];this.applyInsertFormatting(s);const i=this.wordContainingOrdinal(t),r=this.wordContainingOrdinal(e);let o,a;if(t===i.ordinal)if(i.index>0&&!b(this.words[i.index-1])){i.index--,o=[...this.words[i.index].runs()]}else o=[];else o=[...i.word.runs({end:i.offset})];e===r.ordinal?e===this.frame.length-1||b(r.word)?(a=[],r.index--):a=[...r.word.runs()]:a=[...r.word.runs({start:r.offset})];const c=this.frame.length;return this.spliceWordsWithRuns(i.index,r.index-i.index+1,[...l.consolidate(o.concat(s).concat(a))]),this.frame?this.frame.length-c:0}width(){return this._width}setWidth(t){this._width=t,this.layout()}children(){return[this.frame]}toggleCaret(){const t=this.caretVisible;return this.selection.start===this.selection.end&&(this.selectionJustChanged?this.selectionJustChanged=!1:this.caretVisible=!this.caretVisible),this.caretVisible!==t}getCaretCoords(t){const e=this.byOrdinal(t);if(e){if(t>0){const n=this.byOrdinal(t-1);if(n instanceof g.PositionedChar&&n.word.word.softWrap||e.block){if(n instanceof g.PositionedChar&&n.newLine){const t=n.bounds(),e=n.parent().parent().bounds();return new u.default(0,e.b,1,t.h)}{const t=n.bounds();return new u.default(t.r,t.t,1,t.h)}}}const n=e.bounds();return new u.default(n.l,n.t,1,n.h)}}byCoordinate(t,e){return this.frame.byCoordinate(t,e)}urlByCoordinate(t,e){const n=this.byCoordinate(t,e),s=this.range(n.ordinal,n.ordinal).getFormatting().url;if(n.bounds(!0).contains(t,e))return s;if(n instanceof g.PositionedChar){const i=n.previous();if(i&&i.bounds(!0).contains(t,e))return s}}drawSelection(t,e){if(this.selection.end===this.selection.start){if(this.selectionJustChanged||e&&this.caretVisible){const e=this.getCaretCoords(this.selection.start);e&&(t.save(),t.fillStyle="black",e.fill(t),t.restore())}}else{t.save(),t.fillStyle=e?"rgba(0, 100, 200, 0.3)":"rgba(160, 160, 160, 0.3)";for(const e of this.selectedRange().parts())e.bounds(!0).fill(t);t.restore()}}notifySelectionChanged(t){let e=null;const n=this;this.selectionChanged.fire((function(){return e||(e=n.selectedRange().getFormatting()),e}),t)}select(t,e,n){this.frame&&(this.selection.start=Math.max(0,t),this.selection.end=Math.min("number"==typeof e?e:this.selection.start,this.frame.length-1),n&&(this.selectionJustChanged=!0),this.caretVisible=!0,this.nextInsertFormatting={},this.notifySelectionChanged(n))}performUndo(t){const e=t?this.redo:this.undo,n=t?this.undo:this.redo,s=e.pop();s&&(s(t=>{n.push(t)}),this.layout(),this.contentChanged.fire())}canUndo(t){return t?!!this.redo.length:!!this.undo.length}transaction(t){if(this._currentTransaction)t(this._currentTransaction);else{const e=this;for(;this.undo.length>50;)e.undo.shift();this.redo.length=0;let n=!1;this.undo.push(m(s=>{e._currentTransaction=s;try{t(s)}finally{n=s.length>0,e._currentTransaction=null}})),n&&(e.layout(),e.contentChanged.fire())}}insertHyperlink(t,e){const n={text:e||t,url:t};this.selectedRange().setText([n])}switchListTo(t,e){const n=t.getListStyle();this.selection.start;let s;s="number"==e?{$:"listStart"}:{$:"listStart",marker:e};const i=this.wordContainingOrdinal(t.start),r=this.wordContainingOrdinal(t.end);let o,l=i.index,a=r.index;for(l==a&&l>0&&l--,"listEnd"==x(this.words[l])&&"listStart"==x(this.words[l+1])&&l++;l>0&&!b(this.words[l]);)l--;for(;a<this.words.length-1&&!b(this.words[a]);)a++;o=n===e?this.removeList(l,a,s):n?this.switchListStyle(i.index,s):this.rebuildList(t,l,a,s),this.select(o.start,o.end)}removeList(t,e,n){let s=[],i=this.selection.start,r=this.selection.end;const o=this.words[t];"listNext"==x(o)?s=s.concat(y(o,{$:"listEnd"})):t>0&&!b(this.words[t-1])?s=s.concat(y(o,"\n")):("listEnd"==x(this.wordContainingOrdinal(i).word)&&i!=r||i--,r--);for(let n=t+1;n<e;n++){const t=this.words[n];"listNext"==x(t)?s=s.concat(y(t,"\n")):s.push(t)}return"listNext"==x(this.words[e])?s=s.concat(y(this.words[e],n)):e<this.words.length-2&&(s=s.concat(y(this.words[e],"\n"))),this.spliceWords(t,e-t+1,s),{start:i,end:r}}switchListStyle(t,e){for(let n=t;n>=0;n--){const t=this.words[n];if("listStart"==x(t))return this.spliceWordsWithRuns(n,1,[l.cloneWith(t.codeFormatting(),e)]),this.selection}}rebuildList(t,e,n,s){let i=[],r=this.selection.start,o=this.selection.end,l=!this.words[n].isNewLine()&&"listEnd"!=x(this.words[n])||n==this.words.length-1?0:1;if("listNext"==x(this.words[e])){this.range(t.start,t.start).getListStyle()!=(s.marker||"number")?(i=(i=i.concat(y(this.words[e+1],{$:"listEnd"}))).concat(y(this.words[e+1],s)),r++,o++):i.push(this.words[e])}else"listStart"==x(this.words[e])?i=i.concat(y(this.words[e],s)):(0==e?(i=i.concat(y(this.words[e],s)),this.words.length>1&&i.push(this.words[e])):(i.push(this.words[e]),i=i.concat(y(this.words[e+1],s))),r++,o++);for(let t=e+1;t<n;t++){const e=this.words[t];"listEnd"==x(e)&&t!=n-1||e.isNewLine()?i=i.concat(y(e,{$:"listNext"})):i.push(e);const s=this.words[t+1];("listEnd"==x(e)&&s.isNewLine()||e.isNewLine()&&"listStart"==x(s)||"listEnd"==x(e)&&"listStart"==x(s))&&(t++,this.wordOrdinal(t)<r&&r--,this.wordOrdinal(t)<o&&o--)}return i=i.concat(y(this.words[n],{$:"listEnd"})),this.spliceWords(e,n-e+l,i),{start:r,end:o}}}e.CarotaDocument=_},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(0);class i{constructor(t,e,n){this._runs=t,this._run=e,this._offset=n,this.char=e>=t.length?null:s.getTextChar(t[e].text,n)}equals(t){return this._run===t._run&&this._offset===t._offset}*cut(t){for(let e=this._run;e<=t._run;e++){const n=this._runs[e];if(n){const i=e===this._run?this._offset:0,r=e===t._run?t._offset:s.getTextLength(n.text);if(i<r)for(const t of s.getSubText(n.text,i,r-i)){const e=Object.assign({},n);e.text=t,yield e}}}}}e.Character=i,e.characters=function*(t){for(let e=0;e<t.length;e++)for(let n=0;n<s.getTextLength(t[e].text);n++)yield new i(t,e,n);yield new i(t,t.length,0)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(4);e.split=function*(t){let e,n=null,i=null,r=!0;for(const o of t){if(null===o.char)e=!0;else if(r&&(e=!0,r=!1),"string"==typeof o.char)switch(o.char){case" ":i||(i=o);break;case"\n":e=!0,r=!0;break;default:i&&(e=!0)}else{const t=s.default(o.char);(t.block||t.eof)&&(e=!0,r=!0)}if(e){if(n&&!n.equals(o)&&(yield{text:n,spaces:i||o,end:o},i=null),null===o.char)return void(yield null);n=o,e=!1}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(16),i=n(9),r=n(5);e.default=function*(t,e,n,o,l,a,c,h){const d=[];let u,f=0,g=0,p=c||0,w=h||0,m=n;function b(t){if(d.push(t),f+=t.width,p=Math.max(p,t.ascent),w=Math.max(w,t.descent),t.isNewLine())return g=t.ascent+t.descent,y()}function y(){const t=new s.Line(a,e,o,m+p,p,w,d,l);return l+=t.length,m+=p+w,d.length=0,f=p=w=0,t}function x(t,e,n){const s=[],o=[];for(const i of t.runs({start:e,end:n}))"string"==typeof i.text&&""===i.text.trim()?o.push(i):s.push(i);return new i.Word(new i.Section(s.map(r.part)),new i.Section(o.map(r.part)),!0)}for(const n of t)if(u){g=0;const t=u(n);t&&(u=null,l+=t.length,m+=t.bounds().h,t.block=!0,yield t)}else{const t=n.code();if(t&&t.block)d.length&&(yield y()),u=t.block(e,m,o,l,a,n.codeFormatting()),g=0;else if(g=0,n.width>o){d.length&&(yield y());let t=0,e=0;for(;e<=n.length;){const s=[...n.runs({start:t,end:e})];new i.Section(s.map(r.part)).width>o&&(b(x(n,t,e-1)),yield y(),t=e-1),e++}t!=n.length&&b(x(n,t,n.length))}else if(d.length){f+n.text.width>o&&(yield y());const t=b(n);t&&(yield t)}else{const t=b(n);t&&(yield t)}}0==t.length&&(yield y()),d.length?(yield y(),yield m-n):yield m+g-n}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(8),i=n(1),r=n(2);class o extends r.Node{constructor(t,e,n,i,r,o,l,a){super("line"),this.doc=t,this.left=e,this.width=n,this.baseline=i,this.ascent=r,this.descent=o,this.ordinal=a,this.actualWidth=0,this.length=0,l.length>0&&(this.align=l[0].align(),l.forEach(t=>{this.actualWidth+=t.width}),this.actualWidth-=l[l.length-1].space.width);let c=0,h=0;if(this.actualWidth<n)switch(this.align){case"right":c=n-this.actualWidth;break;case"center":c=(n-this.actualWidth)/2;break;case"justify":l.length>1&&!l[l.length-1].isNewLine()&&(h=(n-this.actualWidth)/(l.length-1))}this.positionedWords=l.map(t=>{const e=c;c+=t.width+h;const n=a;return a+=t.length,new s.PositionedWord(t,this,e,n,t.width+h)}),this.length=a-this.ordinal}bounds(t){if(t&&this.positionedWords.length>0){const t=this.first().bounds(),e=this.last().bounds();return new i.default(t.l,this.baseline-this.ascent,e.l+e.w-t.l,this.ascent+this.descent)}return new i.default(this.left,this.baseline-this.ascent,this.width,this.ascent+this.descent)}parent(){return this.doc}children(){return this.positionedWords}}e.Line=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(2),i=n(1);class r extends s.Node{constructor(t,e,n,s,i){super("inline"),this.inline=t,this._parent=e,this.ordinal=n,this.length=s,this.formatting=i,this.measured=t.measure(i)}parent(){return this._parent}draw(t){this.inline.draw(t,this.left,this.baseline,this.measured.width,this.measured.ascent,this.measured.descent,this.formatting)}position(t,e,n){this.left=t,this.baseline=e,n&&(this._bounds=n)}bounds(){return this._bounds||new i.default(this.left,this.baseline-this.measured.ascent,this.measured.width,this.measured.ascent+this.measured.descent)}byCoordinate(t,e){return t<=this.bounds().center().x?this:this.next()}}e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(0),i=n(6),r=n(0);e.Range=class{constructor(t,e,n){this.doc=t,this.start=e,this.end=n,this.doc=t,this.start=e,this.end=n,e>n&&(this.start=n,this.end=e)}*parts(t){t=t||this.doc.children();for(const e of t)if(!(e.ordinal+e.length<=this.start)){if(e.ordinal>=this.end)break;e.ordinal>=this.start&&e.ordinal+e.length<=this.end?yield e:yield*this.parts(e.children())}}clear(){return this.setText([])}setText(t){return this.doc.splice(this.start,this.end,t)}plainText(){return[...i.gmap(this.doc.runs(this),s.getPlainText)].join("")}save(){return[...s.consolidate([...this.doc.runs(this)])]}getFormatting(){if(this.start===this.end){let t=this.start;t>0&&t--,this.start=t,this.end=t+1}const t=i.gfoldl(this.doc.runs(this),s.merge)||r.defaultFormatting;return Object.keys(r.defaultFormatting).forEach(e=>{e in t||(t[e]=r.defaultFormatting[e])}),t}setFormatting(t,e){let n=this;if("align"===t&&(n=n.doc.paragraphRange(n.start,n.end)),n.start===n.end)n.doc.modifyInsertFormatting(t,e);else{const i=n.save(),r={};r[t]=e,s.format(i,r),n.setText(i)}}getListStyle(){const t=this.doc.wordContainingOrdinal(this.start),e=this.doc.wordContainingOrdinal(this.end),n=t=>t.code()&&t.code().name;if(t&&e){let s=e.index;s==this.doc.words.length-1&&s--;for(let e=s-1;e>=0;e--){const s=this.doc.words[e].code(),i=s&&s.name;if("listStart"===i){if(e<=t.index||e==t.index+1&&"listEnd"==n(this.doc.words[e-1]))return s.type||"number";break}if("listEnd"===i)break}}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const t=[],e=function(e){t.push(e)};return e.fire=(...e)=>{t.forEach(t=>{t(...e)})},e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(0),i=function(t,e){return function(n,s){n.nodeName===t&&(s[e]=!0)}},r=function(t,e,n,s){return function(i,r){let o=i[t]&&i[t][e];o&&(s&&(o=s(o)),r[n]=o)}},o=function(t,e,n){return r("attributes",t,e,n)},l=function(t,e,n){return r("style",t,e,n)},a=function(t,e,n){return function(s,i){s.style&&s.style.getPropertyValue(t)===e&&(i[n]=!0)}},c=[6,7,9,10,12,16,20,30],h=["BR","P","H1","H2","H3","H4","H5"],d=["left","center","right","justify"],u=function(t){return d.includes(t)?t:"left"},f=(new Map).set("H1",30).set("H2",20).set("H3",16).set("H4",14).set("H5",12),g=function(t){const e=t.split(/\s*,\s*/g);if(0==e.length)return t;let n=(t=e[0]).match(/^"(.*)"$/);return n?n[1].trim():(n=t.match(/^'(.*)'$/))?n[1].trim():t},p=[i("B","bold"),i("STRONG","bold"),i("I","italic"),i("EM","italic"),i("U","underline"),i("S","strikeout"),i("STRIKE","strikeout"),i("DEL","strikeout"),a("fontWeight","bold","bold"),a("fontStyle","italic","italic"),a("textDecoration","underline","underline"),a("textDecoration","line-through","strikeout"),l("color","color"),l("fontFamily","font",g),l("fontSize","size",t=>{const e=t.match(/^([\d\.]+)pt$/);return e?parseFloat(e[1]):10}),l("textAlign","align",u),function(t,e){"SUB"===t.nodeName&&(e.script="sub")},function(t,e){"SUPER"===t.nodeName&&(e.script="super")},function(t,e){"CODE"===t.nodeName&&(e.font="monospace")},function(t,e){const n=f.get(t.nodeName);n&&(e.size=n)},o("color","color"),o("face","font",g),o("align","align",u),o("size","size",t=>c[t]||10)];e.parse=function(t,e){let n;"string"==typeof t?(n=document.createElement("div")).innerHTML=t:n=t;let i=!0;const r=[],o=function(t,e){r.push(s.cloneWith(e,t))},l=(t,n)=>{if(t instanceof HTMLElement){if(n=Object.assign({},n),t.classList.forEach(t=>{const s=e.get(t);s&&Object.keys(s).forEach(t=>{n[t]=s[t]})}),p.forEach(e=>{e(t,n)}),t.childNodes)for(let e=0;e<t.childNodes.length;e++)l(t.childNodes[e],n);h.includes(t.nodeName)&&(o("\n",n),i=!0)}else!function(t,e){let n=(t=t.replace(/\n+\s*/g," ")).length;t=t.replace(/^\s+/,""),i?i=!1:n!==t.length&&(t=" "+t),(n=t.length)!==(t=t.replace(/\s+$/,"")).length&&(i=!0,t+=" "),o(t,e)}(t.nodeValue,n)};return l(n,{}),[...s.consolidate(r)]}}]);
